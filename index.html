<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‚öôÔ∏è White Panda Web Flasher</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2em auto; line-height: 1.5; }
    h1 { font-size: 1.8rem; }
    button, input { margin: .5em 0; padding: .4em .8em; font-size: 1rem; }
    #log { white-space: pre-wrap; background: #f4f4f4; padding: 1em; height: 200px; overflow: auto; border: 1px solid #ccc; }
    .warning { color: #900; font-weight: bold; }
    .note { color: #555; font-size: .9rem; }
    details { margin-top: 1em; }
    summary { cursor: pointer; font-weight: bold; }
    img { max-width: 100%; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>‚öôÔ∏è White Panda Web Flasher</h1>

  <p class="warning">‚ö†Ô∏è <strong>WARNING</strong> ‚Äî This tool was mostly generated by AI and has not been extensively tested. Use at your own risk! ‚ö†Ô∏è</p>
  
  <p class="note">
    ‚Ä¢ Use a <strong>data-capable</strong> USB cable (USB-A‚ÜíA or USB-C‚ÜíA with data lines).<br>
    ‚Ä¢ The Panda must be manually put into DFU mode before connecting:<br>
      - Short the BOOT and GND pads (small metal pads near the USB connector) while plugging in.<br>
      - If using a Panda Paw (DFU Key), it will automatically do this.<br>
    ‚Ä¢ No lights will illuminate when in DFU mode ‚Äî this is normal.
  </p>

  <details>
    <summary>üì∏ How to enter DFU mode manually (expand for diagram)</summary>
    <p>Locate the BOOT and GND pads near the USB connector on your White Panda.</p>
    <p>Use tweezers, a wire, or similar to short the two pads <strong>while plugging in</strong> to your computer.</p>
    <img src="https://web.archive.org/web/20210302134524im_/https://github.com/commaai/panda/raw/master/docs/bootstub_pins.jpg" alt="White Panda DFU mode pads diagram">
  </details>

  <p class="note">
    ‚û°Ô∏è Official Panda info: <a href="https://comma.ai/shop/panda" target="_blank">comma.ai Panda page</a><br>
    ‚û°Ô∏è Archived technical details: <a href="https://web.archive.org/web/20210302134524/https://github.com/commaai/panda/blob/master/bootstub/README.md" target="_blank">Panda bootstub README (archived)</a>
  </p>

  <button id="connect">1Ô∏è‚É£ Connect Panda (DFU Mode)</button><br>
  <input type="file" id="firmware" accept=".bin,.dfu"/><br>
  <button id="flash" disabled>2Ô∏è‚É£ Flash Firmware</button>

  <div id="log"></div>

  <script type="module">
    import DFU from 'https://cdn.jsdelivr.net/npm/dfu@1.0.2/dist/dfu.esm.min.js';

    const VID = 0x0483, PID = 0xDF11;
    let device = null;

    const logEl = document.getElementById('log');
    function log(msg, isError=false) {
      const line = document.createElement('div');
      line.textContent = msg;
      if (isError) line.style.color = 'red';
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    document.getElementById('connect').addEventListener('click', async () => {
      log('üîç Checking for Panda DFU device‚Ä¶');
      try {
        device = await navigator.usb.requestDevice({ filters: [{ vendorId: VID, productId: PID }] });
        log('‚úÖ Panda DFU detected: ' + device.productName);
        await device.open();
        await device.selectConfiguration(1);
        await device.claimInterface(0);
        log('üîå USB interface claimed.');
        document.getElementById('flash').disabled = false;
      } catch (e) {
        log('‚ùå Cannot connect. Make sure Panda is in DFU mode and cable is data-capable.', true);
        console.error(e);
      }
    });

    document.getElementById('flash').addEventListener('click', async () => {
      const fileInput = document.getElementById('firmware');
      if (!fileInput.files.length) {
        log('‚ö†Ô∏è Please select a firmware file (.bin or .dfu) first.', true);
        return;
      }

      const arrayBuffer = await fileInput.files[0].arrayBuffer();
      const dfu = new DFU(device);

      log('‚è≥ Starting DFU download‚Ä¶ this may take 30‚Äì60s');
      try {
        await dfu.download(new Uint8Array(arrayBuffer), {
          transferSize: 2048,
          interfaceNumber: 0,
        });
        log('üéâ Firmware flashed successfully!');
      } catch (e) {
        log('‚ùå Flash error: ' + e, true);
        console.error(e);
      }
    });
  </script>
</body>
</html>
